#!/usr/bin/env -S fontforge -quiet
# -*- mode: python; coding: utf-8; tab-width: 4 -*-
import os, sys, argparse, re
import operator
sys.path.append(os.path.dirname(os.path.realpath(__file__)) + "/../lib")
from font_utils import fonts_in

args = None
def main():
    global args
    parser = argparse.ArgumentParser()
    parser.add_argument("source_filename")
    parser.add_argument("dest_filenames", nargs="*")
    args = parser.parse_args()
    getter = operator.attrgetter('font', 'filename_open', 'filename_noext', 'ttc')
    for struct in fonts_in([args.source_filename], names=True, ttc=True):
        (font, filename_open, filename_noext, is_ttc) = getter(struct)
        print("%s:" % filename_open)
        for dest_filename in args.dest_filenames:
            is_ext = re.fullmatch(r'\.[-0-9A-Za-z_]+', dest_filename)
            save_ext = dest_filename if is_ext else os.path.splitext(dest_filename)[1]
            save_filename = filename_noext + save_ext  if  is_ttc or is_ext  else  dest_filename
            if save_filename.endswith(".sfd"):
                print("Saving %s" % save_filename)
                font.save(save_filename)
                print("Done.")
            else:
                print("Generating %s" % save_filename)
                font.generate(save_filename)
                print("Done.")

main()
