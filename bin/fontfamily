#!/usr/bin/env -S fontforge -quiet
# -*- mode: python; coding: utf-8 -*-
import os, sys, argparse, fontforge, json, math
progname = os.path.basename(__file__).split(".")[0]
def main():
    global args, progname
    parser = argparse.ArgumentParser()
    parser.add_argument("filenames", nargs="+")
    parser.add_argument("--run-as", "--as")
    parser.add_argument("--path", action="store_true")
    args = parser.parse_args()
    if args.run_as is not None:
        progname = args.run_as
    if args.format == "table":
        if progname not in ["fontmetrics"]:
            raise Exception("--format=table only valid for fontmetrics")
    for filename in args.filenames:
        if args.path:
            visible_filename = filename
        else:
            visible_filename = os.path.basename(filename)
        font_names = fontforge.fontsInFile(filename)
        if len(font_names) == 1:
            font_names = [filename]
        elif len(font_names) == 0:
            font_names = [filename]
        else:
            font_names = ["%s(%s)" % (filename, font_name) for font_name in font_names]
        for font_name in font_names:
            font = fontforge.open(font_name)
            if progname == "fontfamily":
                print("%-40s  %s" % (font.familyname, font_name))
            elif progname == "fontname":
                print("%-40s  %s" % (font.fontname, font_name))
            elif progname == "fontfullname":
                print("%-40s  %s" % (font.fullname, font_name))
            elif progname == "fontweight":
                print("%-40s  %s" % (font.weight, font_name))
            elif progname == "fontvendor":
                print("%-40s  %s" % (font.os2_vendor, font_name))
            elif progname == "fontversion":
                rev = "%-.3f" % font.sfntRevision
                print("%-19s  %-19s  %s" % (rev, font.version, font_name))
            elif progname == "fontinfo":
                rev = "%-.3f" % font.sfntRevision
                print("%s:" % font_name)
                print("    PostScript font name: %s" % font.fontname)
                print("    full name:            %s" % font.fullname)
                print("    family name:          %s" % font.familyname)
                print("    weight name:          %s" % font.weight)
                print("    version:              %s" % font.version)
                print("    sfnt rev:             %s" % rev)
                print("    vendor:               %s" % font.os2_vendor)
            elif progname == "fontmetrics":
                print("%s:" % font_name)
                print("    em:                   %d" % font.em)
                print("    ascent:               %d (%.4g)" % (font.ascent, font.ascent / font.em))
                print("    descent:              %d (%.4g)" % (font.descent, font.descent / font.em))
                print("    cap height:           %.4g (%.4g)" % (font.capHeight, font.capHeight / font.em))
                print("    ex height:            %.4g (%.4g)" % (font.xHeight, font.xHeight / font.em))
                print("    italic angle:         %.4g" % font.italicangle)
            else:
                raise Exception("don't know what to do when running as %s" % repr(progname))

main()
